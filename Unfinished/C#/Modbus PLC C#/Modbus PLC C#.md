# Как я пытался считать переменные с ПЛК с помощью modbus чтобы потом вывести в приложение на C#


# Введение


	HCP Works3 v1.3.0



# Подготовка

Структура наших данных будет такая 2 регистра идёт заголовок остальные - это просто значение переменных имена и всякие метаданные переменных нигде не хранятся они чётко константно прописывается в карте карта - это просто отдельный класс
# Чтение данных

Мы можем сделать отдельные функции для чтения заголовка и значение переменных и ещё третью функцию которая будет вызывать две вот этих функции для удобного использования или можно создать одну функцию которая прочитает Все регистры и распределит их по заголовку и значением переменных

проблема со строками, не понятно как определять длину.
с enum тоже все не просто
есть несколько вариантов чтения
минус в неочевидности, в какие свойства и когда будет записано значение.

# Запись данных

Чтобы


# Константы

встает вопрос как хранить константы.
варианты
# Работа с байтами

в отличии от чтения файлов здесь может меняться заголовок и структура файла. если вы хотите обращаться к элементам через точку то лучше 

# Коннект

Так как макбас работает по обычному tcp соединению у него нету никаких встроенных способов определить разорвался ли Коннект или случился Коннект во время выполнения работы программы для этого нужен некий Pink через таймер или цикл уайл Wild

Так как цикл while будет опрашивать через каждый кадр нам это избыточно мы будем использовать некий таймер по Пингу вместо пинга мы можем попытаться считать один регистр если чтение проходит значит мадбас сервер от баса подключён  или можно использовать некий сокет но этот способ пока не проверен.

проверка подключения через сокет

private bool IsConnected()
    {
        if (_client?.Client == null)
            return false;

        try
        {
            var socket = _client.Client;
            return !(socket.Poll(1, SelectMode.SelectRead) && socket.Available == 0);
        }
        catch
        {
            return false;
        }
    }
через чтение регистров
                    try
                    {
*                        // Минимальный Modbus-запрос (heartbeat)*
                        _master.ReadHoldingRegisters(_slaveId, 0, 1);
                        IsConnected = true;
                       
*                        // Читаем данные*
                        ReadVariables();
                    }
                    catch
                    {
                        Disconnect();
                    }
                }



# Маршаллер

Так как у нас размер переменных в плк не соответствует размеру переменных на C# нужен некий маршалер который будет брать необходимые биты и переводить их в тип на США

# Вывод

На 
# Ссылки


